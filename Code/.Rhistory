facet_label <- c("Cabernet Sauvignon", "Chardonnay")
names(facet_label) <- c("cabernet sauvignon", "chardonnay")
ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_boxplot(outlier.shape = NA)+ xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
geom_jitter(width = 0.2, color = "black") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("a","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion, labeller = labeller(scion = facet_label))
pairs(emmeans(fphd_16s_fit.mod, ~ rootstock|scion))
ggplot(alpha_diversity.df, aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_boxplot(outlier.shape = NA)+ xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
geom_jitter(width = 0.2, color = "black") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("a","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion, labeller = labeller(scion = facet_label))
ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_boxplot(outlier.shape = NA)+ xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
geom_jitter(width = 0.2, color = "black") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("a","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion, labeller = labeller(scion = facet_label))
pairs(emmeans(fphd_16s_fit.mod, ~ rootstock|scion|plant_body_site))
pairs(emmeans(fphd_16s_fit.mod, ~ rootstock|scion*plant_body_site))
pairs(emmeans(fphd_16s_fit.mod, ~ rootstock|scion|plant_body_site))
pairs(emmeans(fphd_16s_fit.mod, ~ rootstock|plant_body_site))
pairs(emmeans(fphd_16s_fit.mod, ~ rootstock|scion|plant_body_site))
pairs(emmeans(fphd_16s_fit.mod, ~ rootstock|scion))
ggplot(alpha_diversity.df, aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_boxplot(outlier.shape = NA)+ xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
geom_jitter(width = 0.2, color = "black") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("a","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion, labeller = labeller(scion = facet_label))
####### Figure 3 ######
# alpha diversity (Faith across compartments)
# Make a tibble to store where to place significance letters from the Tukey test
labels_df <- tibble(plant_body_site=levels(alpha_diversity.df$plant_body_site), rootstock=levels(alpha_diversity.df$rootstock), Mfaith=max(alpha_diversity.df$Faithpd) * 1.2)
TukeyHSD(aov(Faithpd ~ plant_body_site, data = alpha_diversity.df), conf.level = 0.95)
fig3A <- ggplot(alpha_diversity.df, aes(plant_body_site, Faithpd, fill = plant_body_site)) +
geom_jitter(width = 0.25, color = "black") +
xlab ("Compartment") +
geom_boxplot(outlier.shape = NA, alpha = 0.8, color = "black") +
theme(legend.position = "top") +
ylab("Faith's phylogenetic diversity") +
scale_fill_manual(name="Compartment", breaks=c("berry", "leaf", "root"),
labels=c("Berry","Leaf", "Root"), values = compartment_palette) +
scale_x_discrete(breaks=c("berry", "leaf", "root"), labels=c("Berry", "Leaf", "Root")) +
geom_text(data=labels_df, aes(plant_body_site, Mfaith, label=c("a","a","b")), size = 6)
fig3A
# Stats mean faith for compartments for main text
mean(alpha_diversity.df[alpha_diversity.df$plant_body_site == 'berry',]$Faithpd) #4.633959
mean(alpha_diversity.df[alpha_diversity.df$plant_body_site == 'leaf',]$Faithpd) #5.709501
mean(alpha_diversity.df[alpha_diversity.df$plant_body_site == 'root',]$Faithpd) #61.06594
# Boxplot of scion X rootstock X compartment faith
facet_label <- c("Cabernet Sauvignon", "Chardonnay")
names(facet_label) <- c("cabernet sauvignon", "chardonnay")
fig3B <- ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_boxplot(outlier.shape = NA)+ xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
geom_jitter(width = 0.2, color = "black") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("a","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion, labeller = labeller(scion = facet_label))
fig3 <- ggarrange(fig3A,fig3B, labels = c('A', 'B'))
#
ggsave("figure3_faith_by_compartment_and_rootsock-scion.svg", fig2, height = 6, width = 10, bg = 'white', dpi = 1200)
ggsave("figure3_faith_by_compartment_and_rootsock-scion.pdf", fig2, height = 6, width = 10)
# Stats
# We found that Teleki 5C showed lower alpha diversity (faith) than the other rootstocks,
# this was particularly apparent in the root samples. Below are some summary stats for the
# rootstocks. It seems that at Merced in particular the values are much lower than the mean
# for other rootstocks and even the scion/rootstock combo at another site.
summarySE(alpha_diversity.df, measurevar = "Faithpd", groupvars = c("plant_body_site", "rootstock", "scion"))
summarySE(alpha_diversity.df, measurevar = "Faithpd", groupvars = c("plant_body_site", "rootstock", "scion", "site"))
# Stats
# We found that Teleki 5C showed lower alpha diversity (faith) than the other rootstocks,
# this was particularly apparent in the root samples. Below are some summary stats for the
# rootstocks. It seems that at Merced in particular the values are much lower than the mean
# for other rootstocks and even the scion/rootstock combo at another site.
summarySE(alpha_diversity.df, measurevar = "Faithpd", groupvars = c("plant_body_site", "rootstock", "scion"))
summarySE(alpha_diversity.df, measurevar = "Faithpd", groupvars = c("plant_body_site", "rootstock", "scion", "site"))
fig3
ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_boxplot(outlier.shape = NA)+ xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
geom_jitter(width = 0.2, color = "black") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("a","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion*site)
ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_boxplot(outlier.shape = NA)+ xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
geom_jitter(width = 0.2, color = "black") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("a","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion+site)
ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_boxplot(outlier.shape = NA)+ xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
geom_jitter(width = 0.2, color = "black") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
#geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("a","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion+site)
ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_boxplot(outlier.shape = NA)+ xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
geom_jitter(width = 0.2, color = "black") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("a","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion, labeller = labeller(scion = facet_label))
ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_jitter(width = 0.2, color = "black") +
geom_boxplot(outlier.shape = NA, alpha = 0.8, color = "black") + xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("a","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion, labeller = labeller(scion = facet_label))
fig3B <- ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_jitter(width = 0.2, color = "black") +
geom_boxplot(outlier.shape = NA, alpha = 0.8, color = "black") + xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("a","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion, labeller = labeller(scion = facet_label))
fig3 <- ggarrange(fig3A,fig3B, labels = c('A', 'B'))
#
ggsave("figure3_faith_by_compartment_and_rootsock-scion.svg", fig2, height = 6, width = 10, bg = 'white', dpi = 1200)
####### Figure 3 ######
# alpha diversity (Faith across compartments)
# Make a tibble to store where to place significance letters from the Tukey test
labels_df <- tibble(plant_body_site=levels(alpha_diversity.df$plant_body_site), rootstock=levels(alpha_diversity.df$rootstock), Mfaith=max(alpha_diversity.df$Faithpd) * 1.2)
TukeyHSD(aov(Faithpd ~ plant_body_site, data = alpha_diversity.df), conf.level = 0.95)
fig3A <- ggplot(alpha_diversity.df, aes(plant_body_site, Faithpd, fill = plant_body_site)) +
geom_jitter(width = 0.25, color = "black") +
xlab ("Compartment") +
geom_boxplot(outlier.shape = NA, alpha = 0.8, color = "black") +
theme(legend.position = "top") +
ylab("Faith's phylogenetic diversity") +
scale_fill_manual(name="Compartment", breaks=c("berry", "leaf", "root"),
labels=c("Berry","Leaf", "Root"), values = compartment_palette) +
scale_x_discrete(breaks=c("berry", "leaf", "root"), labels=c("Berry", "Leaf", "Root")) +
geom_text(data=labels_df, aes(plant_body_site, Mfaith, label=c("a","a","b")), size = 6)
# Stats mean faith for compartments for main text
mean(alpha_diversity.df[alpha_diversity.df$plant_body_site == 'berry',]$Faithpd) #4.633959
mean(alpha_diversity.df[alpha_diversity.df$plant_body_site == 'leaf',]$Faithpd) #5.709501
mean(alpha_diversity.df[alpha_diversity.df$plant_body_site == 'root',]$Faithpd) #61.06594
# Boxplot of scion X rootstock X compartment faith
facet_label <- c("Cabernet Sauvignon", "Chardonnay")
names(facet_label) <- c("cabernet sauvignon", "chardonnay")
fig3B <- ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_jitter(width = 0.2, color = "black") +
geom_boxplot(outlier.shape = NA, alpha = 0.8, color = "black") + xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("a","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion, labeller = labeller(scion = facet_label))
fig3 <- ggarrange(fig3A,fig3B, labels = c('A', 'B'))
#
ggsave("figure3_faith_by_compartment_and_rootsock-scion.svg", fig3, height = 6, width = 10, bg = 'white', dpi = 1200)
ggsave("figure3_faith_by_compartment_and_rootsock-scion.pdf", fig3, height = 6, width = 10)
ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_jitter(width = 0.2, color = "black") +
geom_boxplot(outlier.shape = NA, alpha = 0.8, color = "black") + xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("a","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion, labeller = labeller(scion = facet_label)) +
theme(axis.text.x = element_blank())
ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_jitter(width = 0.2, color = "black") +
geom_boxplot(outlier.shape = NA, alpha = 0.8, color = "black") + xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("a","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion, labeller = labeller(scion = facet_label)) +
theme(axis.text.x = element_blank(), axis.ticks.x = element_blank())
fig3B <- ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_jitter(width = 0.2, color = "black") +
geom_boxplot(outlier.shape = NA, alpha = 0.8, color = "black") + xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("a","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion, labeller = labeller(scion = facet_label)) +
theme(axis.text.x = element_blank(), axis.ticks.x = element_blank())
fig3 <- ggarrange(fig3A,fig3B, labels = c('A', 'B'))
#
ggsave("figure3_faith_by_compartment_and_rootsock-scion.svg", fig3, height = 6, width = 10, bg = 'white', dpi = 1200)
ggsave("figure3_faith_by_compartment_and_rootsock-scion.pdf", fig3, height = 6, width = 10)
fig3 <- ggarrange(fig3A,fig3B, labels = c('A', 'B'), align = "hv")
#
ggsave("figure3_faith_by_compartment_and_rootsock-scion.svg", fig3, height = 6, width = 10, bg = 'white', dpi = 1200)
ggsave("figure3_faith_by_compartment_and_rootsock-scion.pdf", fig3, height = 6, width = 10)
lmerTest::lmer(Faithpd ~ rootstock*scion + plant_body_site*brix + year + site + (1|sequence_depth), data = alpha_diversity.df)
fig3B <- ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_jitter(width = 0.2, color = "black") +
geom_boxplot(outlier.shape = NA, alpha = 0.8, color = "black") + xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
facet_wrap(~scion, labeller = labeller(scion = facet_label)) +
theme(axis.text.x = element_blank(), axis.ticks.x = element_blank())
fig3 <- ggarrange(fig3A,fig3B, labels = c('A', 'B'), align = "hv")
#
ggsave("figure3_faith_by_compartment_and_rootsock-scion.svg", fig3, height = 6, width = 10, bg = 'white', dpi = 1200)
ggsave("figure3_faith_by_compartment_and_rootsock-scion.pdf", fig3, height = 6, width = 10)
TukeyHSD(aov(Faithpd ~ rootstock*scion, data = alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",]), conf.level = 0.95)
ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_jitter(width = 0.2, color = "black") +
geom_boxplot(outlier.shape = NA, alpha = 0.8, color = "black") + xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("ab","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion, labeller = labeller(scion = facet_label)) +
theme(axis.text.x = element_blank(), axis.ticks.x = element_blank())
fig3B <- ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_jitter(width = 0.2, color = "black") +
geom_boxplot(outlier.shape = NA, alpha = 0.8, color = "black") + xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("ab","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion, labeller = labeller(scion = facet_label)) +
theme(axis.text.x = element_blank(), axis.ticks.x = element_blank())
fig3 <- ggarrange(fig3A,fig3B, labels = c('A', 'B'), align = "hv")
#
ggsave("figure3_faith_by_compartment_and_rootsock-scion.svg", fig3, height = 6, width = 10, bg = 'white', dpi = 1200)
ggsave("figure3_faith_by_compartment_and_rootsock-scion.pdf", fig3, height = 6, width = 10)
fig3 <- ggarrange(fig3A,fig3B, labels = c('A', 'B'))
#
ggsave("figure3_faith_by_compartment_and_rootsock-scion.svg", fig3, height = 6, width = 10, bg = 'white', dpi = 1200)
ggsave("figure3_faith_by_compartment_and_rootsock-scion.pdf", fig3, height = 6, width = 10)
#Packages w/ version numbers.
library('tidyverse'); packageVersion('tidyverse')
library('ggpubr'); packageVersion('ggpubr')
library('car'); packageVersion('car')
library('lme4'); packageVersion('lme4')
library('lmerTest'); packageVersion('lmerTest')
library('vegan'); packageVersion('vegan')
library('phyloseq'); packageVersion('phyloseq')
library('qiime2R'); packageVersion('qiime2R')
library('DESeq2'); packageVersion('DESeq2')
##### 1.0) ALPHA DIVERSITY ANALYSIS #####
alpha_diversity.df <- Alpha_div_metrics(phy_vst)
# Lmer models
fphd_16s_fit.mod <- lmerTest::lmer(Faithpd ~ rootstock*scion + plant_body_site*brix + year + site + (1|sequence_depth), data = alpha_diversity.df)
simpI_16s_fit.mod <- lmerTest::lmer(Invsimpson ~ rootstock*scion + plant_body_site*brix + year + site + (1|sequence_depth), data = alpha_diversity.df)
# load dataset generated from Data_filtering_normalization.R
phy_vst <- readRDS("../Data_files/phyloseq_16s_no_soil_filtered_vst_dataset.rds")
##### 1.0) ALPHA DIVERSITY ANALYSIS #####
alpha_diversity.df <- Alpha_div_metrics(phy_vst)
##### Functions #####
# Calculate shannon, inverse simpson, and faith's phylogeny diversity metrics from a phyloseq object
Alpha_div_metrics <- function(phyloseq_obj){
SH <- as.data.frame(vegan::diversity(t(otu_table(phyloseq_obj)), index="shannon"))
IS <- as.data.frame(vegan::diversity(t(otu_table(phyloseq_obj)), index="invsimpson"))
CH <- as.data.frame(t(estimateR(round(t(otu_table(phyloseq_obj))))))
CH <- as.data.frame(CH$S.chao1)
alpha_div <- cbind(SH, IS, CH)
colnames(alpha_div) <-c("Shannon", "Invsimpson", "Chao1")
R <- picante::pd(samp = t(otu_table(phyloseq_obj)), tree = phy_tree(phyloseq_obj), include.root = TRUE)
alpha_div <- cbind(alpha_div, "Faithpd" = R$PD, as.data.frame(phyloseq_obj@sam_data))
return(alpha_div)
}
# Function from the R cookbook
# From: http://www.cookbook-r.com/Manipulating_data/Summarizing_data/
## Summarizes data.
## Gives count, mean, standard deviation, standard error of the mean, and confidence interval (default 95%).
##   data: a data frame.
##   measurevar: the name of a column that contains the variable to be summariezed
##   groupvars: a vector containing names of columns that contain grouping variables
##   na.rm: a boolean that indicates whether to ignore NA's
##   conf.interval: the percent range of the confidence interval (default is 95%)
summarySE <- function(data=NULL, measurevar, groupvars=NULL, na.rm=FALSE,
conf.interval=.95, .drop=TRUE) {
library(plyr)
# New version of length which can handle NA's: if na.rm==T, don't count them
length2 <- function (x, na.rm=FALSE) {
if (na.rm) sum(!is.na(x))
else       length(x)
}
# This does the summary. For each group's data frame, return a vector with
# N, mean, and sd
datac <- ddply(data, groupvars, .drop=.drop,
.fun = function(xx, col) {
c(N    = length2(xx[[col]], na.rm=na.rm),
mean = mean   (xx[[col]], na.rm=na.rm),
sd   = sd     (xx[[col]], na.rm=na.rm)
)
},
measurevar
)
# Rename the "mean" column
datac <- rename(datac, c("mean" = measurevar))
datac$se <- datac$sd / sqrt(datac$N)  # Calculate standard error of the mean
# Confidence interval multiplier for standard error
# Calculate t-statistic for confidence interval:
# e.g., if conf.interval is .95, use .975 (above/below), and use df=N-1
ciMult <- qt(conf.interval/2 + .5, datac$N-1)
datac$ci <- datac$se * ciMult
return(datac)
}
# Function by ZNH to id outliers past a defined distance.
is_gt <- function(object, dist, threshold){
samples <- rownames(object)[dist > threshold | dist < -threshold]
return(samples)
}
# Plot PCoA using ggplot from phyloseq ordination
PLOT_PCoA <- function(plot_data, distance_matrix, axis1, axis2, split_by){
if (split_by == 'site'){
temp <- plot_ordination(plot_data, distance_matrix, axes = c(axis1,axis2))
temp[["layers"]][[1]][["geom"]][["default_aes"]][["colour"]] <- "white" # make the plot_ordination points white to allow me to use alpha without them showing through.
Plot <- plot_ordination(plot_data, distance_matrix, axes = c(axis1,axis2)) +
geom_point(aes(fill=lower_political, shape=plant_body_site), size = 5, alpha = 0.80, color = "black") +
scale_shape_manual(values=c(22, 24, 21), labels = c("Berry", "Leaf", "Root")) +
scale_fill_manual(name = "Site", values=site_palette, labels = c("Madera", "Merced", "San Joaquin")) +
labs(shape= "Compartment", color= "Site") +
xlab(paste("PCoA", axis1, sub(".*\\ ", "", temp$labels$x))) +
ylab(paste("PCoA", axis2, sub(".*\\ ", "", temp$labels$y))) +
guides(fill = guide_legend(override.aes = c(shape = 21, alpha = 1)), color = guide_legend(override.aes = c(alpha=1)))
return(Plot)
} else if(split_by == 'rootstock'){
temp <- plot_ordination(plot_data, distance_matrix, axes = c(axis1,axis2))
temp[["layers"]][[1]][["geom"]][["default_aes"]][["colour"]] <- "white" # make the plot_ordination points white to allow me to use alpha without them showing through.
Plot <- plot_ordination(plot_data, distance_matrix, axes = c(axis1,axis2)) +
geom_point(aes(fill=rootstock, shape=plant_body_site), size = 5, alpha = 0.80, color = "black") +
scale_shape_manual(values=c(22, 24, 21)) +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
labs(shape= "Compartment", color= "Site") +
xlab(paste("PCoA", axis1, sub(".*\\ ", "", temp$labels$x))) +
ylab(paste("PCoA", axis2, sub(".*\\ ", "", temp$labels$y))) +
guides(fill = guide_legend(override.aes = c(shape = 21, alpha = 1)), color = guide_legend(override.aes = c(alpha=1)))
return(Plot)
} else if(split_by == 'scion'){
temp <- plot_ordination(plot_data, distance_matrix, axes = c(axis1,axis2))
temp[["layers"]][[1]][["geom"]][["default_aes"]][["colour"]] <- "white" # make the plot_ordination points white to allow me to use alpha without them showing through.
Plot <- plot_ordination(plot_data, distance_matrix, axes = c(axis1,axis2)) +
geom_point(aes(fill=scion, shape=plant_body_site), size = 5, alpha = 0.80, color = "black") +
scale_shape_manual(values=c(22, 24, 21)) +
scale_fill_manual(name = "Scion", values=scion_palette) +
labs(shape= "Compartment", color= "Site") +
xlab(paste("PCoA", axis1, sub(".*\\ ", "", temp$labels$x))) +
ylab(paste("PCoA", axis2, sub(".*\\ ", "", temp$labels$y))) +
guides(fill = guide_legend(override.aes = c(shape = 21, alpha = 1)), color = guide_legend(override.aes = c(alpha=1)))
return(Plot)
} else if(split_by == 'year'){
temp <- plot_ordination(plot_data, distance_matrix, axes = c(axis1,axis2))
temp[["layers"]][[1]][["geom"]][["default_aes"]][["colour"]] <- "white" # make the plot_ordination points white to allow me to use alpha without them showing through.
Plot <- plot_ordination(plot_data, distance_matrix, axes = c(axis1,axis2)) +
geom_point(aes(fill=year, shape=plant_body_site), size = 5, alpha = 0.80, color = "black") +
scale_shape_manual(values=c(22, 24, 21)) +
#scale_fill_manual(name = "Scion", values=scion_palette) +
labs(shape= "Compartment", color= "Site") +
xlab(paste("PCoA", axis1, sub(".*\\ ", "", temp$labels$x))) +
ylab(paste("PCoA", axis2, sub(".*\\ ", "", temp$labels$y))) +
guides(fill = guide_legend(override.aes = c(shape = 21, alpha = 1)), color = guide_legend(override.aes = c(alpha=1)))
return(Plot)
}  else if(split_by == 'col_week'){
temp <- plot_ordination(plot_data, distance_matrix, axes = c(axis1,axis2))
temp[["layers"]][[1]][["geom"]][["default_aes"]][["colour"]] <- "white" # make the plot_ordination points white to allow me to use alpha without them showing through.
Plot <- plot_ordination(plot_data, distance_matrix, axes = c(axis1,axis2)) +
geom_point(aes(fill=col_week, shape=plant_body_site), size = 5, alpha = 0.80, color = "black") +
scale_shape_manual(values=c(22, 24, 21)) +
#scale_fill_manual(name = "Scion", values=scion_palette) +
labs(shape= "Compartment", color= "Site") +
xlab(paste("PCoA", axis1, sub(".*\\ ", "", temp$labels$x))) +
ylab(paste("PCoA", axis2, sub(".*\\ ", "", temp$labels$y))) +
guides(fill = guide_legend(override.aes = c(shape = 21, alpha = 1)), color = guide_legend(override.aes = c(alpha=1)))
return(Plot)
}   else if(split_by == 'block'){
temp <- plot_ordination(plot_data, distance_matrix, axes = c(axis1,axis2))
temp[["layers"]][[1]][["geom"]][["default_aes"]][["colour"]] <- "white" # make the plot_ordination points white to allow me to use alpha without them showing through.
Plot <- plot_ordination(plot_data, distance_matrix, axes = c(axis1,axis2)) +
geom_point(aes(fill=block, shape=plant_body_site), size = 5, alpha = 0.80, color = "black") +
scale_shape_manual(values=c(22, 24, 21)) +
#scale_fill_manual(name = "Scion", values=scion_palette) +
labs(shape= "Compartment", color= "Site") +
xlab(paste("PCoA", axis1, sub(".*\\ ", "", temp$labels$x))) +
ylab(paste("PCoA", axis2, sub(".*\\ ", "", temp$labels$y))) +
guides(fill = guide_legend(override.aes = list(shape = 21)), shape = guide_legend(override.aes = list(fill = "black")))
return(Plot)
}
}
# Given a phyloseq object, return a dataframe of the sample metadata
# From: https://jacobrprice.github.io/2017/08/26/phyloseq-to-vegan-and-back.html
pssd2veg <- function(physeq) {
sd <- sample_data(physeq)
return(as(sd,"data.frame"))
}
# load dataset generated from Data_filtering_normalization.R
phy_vst <- readRDS("../Data_files/phyloseq_16s_no_soil_filtered_vst_dataset.rds")
##### 1.0) ALPHA DIVERSITY ANALYSIS #####
alpha_diversity.df <- Alpha_div_metrics(phy_vst)
# Lmer models
fphd_16s_fit.mod <- lmerTest::lmer(Faithpd ~ rootstock*scion + plant_body_site*brix + year + site + (1|sequence_depth), data = alpha_diversity.df)
simpI_16s_fit.mod <- lmerTest::lmer(Invsimpson ~ rootstock*scion + plant_body_site*brix + year + site + (1|sequence_depth), data = alpha_diversity.df)
chao1_16s_fit.mod <- lmerTest::lmer(Chao1 ~ rootstock*scion + plant_body_site*brix + year + site + (1|sequence_depth), data = alpha_diversity.df)
# anovas, paste these into excel
anova(fphd_16s_fit.mod)
anova(simpI_16s_fit.mod)
anova(chao1_16s_fit.mod)
# check the random effects
rand(fphd_16s_fit.mod)
rand(simpI_16s_fit.mod)
rand(chao1_16s_fit.mod)
# posthocs
pairs(emmeans(fphd_16s_fit.mod, ~ rootstock))
# posthocs
pairs(emmeans(fphd_16s_fit.mod, ~ rootstock))
#Packages w/ version numbers.
library('tidyverse'); packageVersion('tidyverse')
library('ggpubr'); packageVersion('ggpubr')
library('car'); packageVersion('car')
library('lme4'); packageVersion('lme4')
library('lmerTest'); packageVersion('lmerTest')
library('vegan'); packageVersion('vegan')
library('phyloseq'); packageVersion('phyloseq')
library('qiime2R'); packageVersion('qiime2R')
library('DESeq2'); packageVersion('DESeq2')
library('emmeans'); packageVersion('emmeans')
library('lubridate'); packageVersion('lubridate')
library('rebus'); packageVersion('rebus')
library('viridis'); packageVersion('viridis')
library('corrplot'); packageVersion('corrplot')
library('factoextra'); packageVersion('factoextra')
pairs(emmeans(fphd_16s_fit.mod, ~ rootstock|scion))
####### Figure 3 ######
# alpha diversity (Faith across compartments)
# Make a tibble to store where to place significance letters from the Tukey test
labels_df <- tibble(plant_body_site=levels(alpha_diversity.df$plant_body_site), rootstock=levels(alpha_diversity.df$rootstock), Mfaith=max(alpha_diversity.df$Faithpd) * 1.2)
TukeyHSD(aov(Faithpd ~ plant_body_site, data = alpha_diversity.df), conf.level = 0.95)
fig3A <- ggplot(alpha_diversity.df, aes(plant_body_site, Faithpd, fill = plant_body_site)) +
geom_jitter(width = 0.25, color = "black") +
xlab ("Compartment") +
geom_boxplot(outlier.shape = NA, alpha = 0.8, color = "black") +
theme(legend.position = "top") +
ylab("Faith's phylogenetic diversity") +
scale_fill_manual(name="Compartment", breaks=c("berry", "leaf", "root"),
labels=c("Berry","Leaf", "Root"), values = compartment_palette) +
scale_x_discrete(breaks=c("berry", "leaf", "root"), labels=c("Berry", "Leaf", "Root")) +
geom_text(data=labels_df, aes(plant_body_site, Mfaith, label=c("a","a","b")), size = 6)
# Theme set and Color Palettes
theme_set(theme_pubr())
rootstock_palette <- c('#1b9e77', '#f0a4af', '#7570b3')
scion_palette <- c('#ed254e', '#0e79b2')
site_palette <- c('#e6ab02', '#281c39', '#12664c')
compartment_palette <- c("#5a1991", "#139d08", "#5c3c0d") #https://lospec.com/palette-list/famicube
safe_colorblind_palette <- c("#88CCEE", "#CC6677", "#DDCC77", "#AA4499", "#332288", "#117733",
"#661100", "#999933", "#44AA99", "#882255", "#6699CC", "#888888")
####### Figure 3 ######
# alpha diversity (Faith across compartments)
# Make a tibble to store where to place significance letters from the Tukey test
labels_df <- tibble(plant_body_site=levels(alpha_diversity.df$plant_body_site), rootstock=levels(alpha_diversity.df$rootstock), Mfaith=max(alpha_diversity.df$Faithpd) * 1.2)
TukeyHSD(aov(Faithpd ~ plant_body_site, data = alpha_diversity.df), conf.level = 0.95)
fig3A <- ggplot(alpha_diversity.df, aes(plant_body_site, Faithpd, fill = plant_body_site)) +
geom_jitter(width = 0.25, color = "black") +
xlab ("Compartment") +
geom_boxplot(outlier.shape = NA, alpha = 0.8, color = "black") +
theme(legend.position = "top") +
ylab("Faith's phylogenetic diversity") +
scale_fill_manual(name="Compartment", breaks=c("berry", "leaf", "root"),
labels=c("Berry","Leaf", "Root"), values = compartment_palette) +
scale_x_discrete(breaks=c("berry", "leaf", "root"), labels=c("Berry", "Leaf", "Root")) +
geom_text(data=labels_df, aes(plant_body_site, Mfaith, label=c("a","a","b")), size = 6)
# Stats mean faith for compartments for main text
mean(alpha_diversity.df[alpha_diversity.df$plant_body_site == 'berry',]$Faithpd) #4.633959
mean(alpha_diversity.df[alpha_diversity.df$plant_body_site == 'leaf',]$Faithpd) #5.709501
mean(alpha_diversity.df[alpha_diversity.df$plant_body_site == 'root',]$Faithpd) #61.06594
# Boxplot of scion X rootstock X compartment faith
facet_label <- c("Cabernet Sauvignon", "Chardonnay")
names(facet_label) <- c("cabernet sauvignon", "chardonnay")
TukeyHSD(aov(Faithpd ~ rootstock*scion, data = alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",]), conf.level = 0.95)
fig3B <- ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_jitter(width = 0.2, color = "black") +
geom_boxplot(outlier.shape = NA, alpha = 0.8, color = "black") + xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("ab","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion, labeller = labeller(scion = facet_label)) +
theme(axis.text.x = element_blank(), axis.ticks.x = element_blank())
fig3 <- ggarrange(fig3A,fig3B, labels = c('A', 'B'))
#
ggsave("figure3_faith_by_compartment_and_rootsock-scion.svg", fig3, height = 6, width = 10, bg = 'white', dpi = 1200)
ggsave("figure3_faith_by_compartment_and_rootsock-scion.pdf", fig3, height = 6, width = 10)
# Stats
# We found that Teleki 5C showed lower alpha diversity (faith) than the other rootstocks,
# this was particularly apparent in the root samples. Below are some summary stats for the
# rootstocks. It seems that at Merced in particular the values are much lower than the mean
# for other rootstocks and even the scion/rootstock combo at another site.
summarySE(alpha_diversity.df, measurevar = "Faithpd", groupvars = c("plant_body_site", "rootstock", "scion"))
####### Figure 3 ######
# alpha diversity (Faith across compartments)
# Make a tibble to store where to place significance letters from the Tukey test
labels_df <- tibble(plant_body_site=levels(alpha_diversity.df$plant_body_site), rootstock=levels(alpha_diversity.df$rootstock), Mfaith=max(alpha_diversity.df$Faithpd) * 1.2)
TukeyHSD(aov(Faithpd ~ plant_body_site, data = alpha_diversity.df), conf.level = 0.95)
fig3A <- ggplot(alpha_diversity.df, aes(plant_body_site, Faithpd, fill = plant_body_site)) +
geom_jitter(width = 0.25, color = "black") +
xlab ("Compartment") +
geom_boxplot(outlier.shape = NA, alpha = 0.8, color = "black") +
theme(legend.position = "top") +
ylab("Faith's phylogenetic diversity") +
scale_fill_manual(name="Compartment", breaks=c("berry", "leaf", "root"),
labels=c("Berry","Leaf", "Root"), values = compartment_palette) +
scale_x_discrete(breaks=c("berry", "leaf", "root"), labels=c("Berry", "Leaf", "Root")) +
geom_text(data=labels_df, aes(plant_body_site, Mfaith, label=c("a","a","b")), size = 6) +
theme(axis.text.x = element_blank(), axis.ticks.x = element_blank())
# Stats mean faith for compartments for main text
mean(alpha_diversity.df[alpha_diversity.df$plant_body_site == 'berry',]$Faithpd) #4.633959
mean(alpha_diversity.df[alpha_diversity.df$plant_body_site == 'leaf',]$Faithpd) #5.709501
mean(alpha_diversity.df[alpha_diversity.df$plant_body_site == 'root',]$Faithpd) #61.06594
# Boxplot of scion X rootstock X compartment faith
facet_label <- c("Cabernet Sauvignon", "Chardonnay")
names(facet_label) <- c("cabernet sauvignon", "chardonnay")
TukeyHSD(aov(Faithpd ~ rootstock*scion, data = alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",]), conf.level = 0.95)
fig3B <- ggplot(alpha_diversity.df[alpha_diversity.df$plant_body_site == "root",], aes(x=rootstock, y=Faithpd,  fill=rootstock)) +
geom_jitter(width = 0.2, color = "black") +
geom_boxplot(outlier.shape = NA, alpha = 0.8, color = "black") + xlab ("Rootstock") + ylab("Faith's phylogenetic diversity") +
scale_fill_manual(name = "Rootstock", values=rootstock_palette) +
geom_text(data=labels_df, aes(rootstock, Mfaith, label=c("ab","a","a","a","a","b")), size = 6) + ylim(0, NA) +
facet_wrap(~scion, labeller = labeller(scion = facet_label)) +
theme(axis.text.x = element_blank(), axis.ticks.x = element_blank())
fig3 <- ggarrange(fig3A,fig3B, labels = c('A', 'B'))
#
ggsave("figure3_faith_by_compartment_and_rootsock-scion.svg", fig3, height = 6, width = 10, bg = 'white', dpi = 1200)
ggsave("figure3_faith_by_compartment_and_rootsock-scion.pdf", fig3, height = 6, width = 10)
# save
ggsave("figure3_faith_by_compartment_and_rootsock-scion.svg", fig3, height = 6, width = 10, bg = 'white', dpi = 1200)
ggsave("figure3_faith_by_compartment_and_rootsock-scion.pdf", fig3, height = 6, width = 10)
# save
ggsave("figure3_faith_by_compartment_and_rootsock-scion.svg", fig3, height = 6, width = 3.3, bg = 'white', dpi = 1200)
